(function(e,h){var g=e.rangy||null,c=e.Undo||null,f=e.Key={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capsLock:20,escape:27,pageUp:33,pageDown:34,end:35,home:36,leftArrow:37,upArrow:38,rightArrow:39,downArrow:40,insert:45,"delete":46,"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftWindow:91,rightWindowKey:92,select:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalPoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numLock:144,scrollLock:145,semiColon:186,equalSign:187,comma:188,dash:189,period:190,forwardSlash:191,graveAccent:192,openBracket:219,backSlash:220,closeBraket:221,singleQuote:222},b=(function(){var d=function(q){var w=this,o=new d.Action(),j=new d.Cache(),v=new d.Cursor(this),t=new d.Selection(),u={focus:function(i){i=i||e.event;d.activeElement=l;w.placeholders()},blur:function(i){i=i||e.event;if(d.activeElement===l){d.activeElement=null}w.placeholders()},down:function(A){A=A||e.event;var x=true;if(A.keyCode===229){return}a.isCommand(n,A,function(){j.cmd=true},function(){j.cmd=false});a.isShift(A,function(){j.shift=true},function(){j.shift=false});a.isModifier(n,A,function(D){if(j.cmd){if(((n.mode===d.inlineMode)||(n.mode===d.partialMode))&&D!=="paste"){a.preventDefaultEvent(A);return}var C=typeof D;var B=null;if(C==="function"){B=D}else{B=u.command[D]}x=B.call(w,A);if(x===false){a.preventDefaultEvent(A);a.stopPropagation(A)}}});if(n.maxLength!==-1){var i=a.text(l).length,y=false,z=e.getSelection();if(z){y=!z.isCollapsed}if(i>=n.maxLength&&!a.isSpecial(A)&&!a.isNavigational(A)&&!y){n.maxLengthReached(n.element);return a.preventDefaultEvent(A)}}switch(A.keyCode){case f.enter:u.enterKey(A);break;case f.backspace:case f["delete"]:u.backspaceOrDeleteKey(A);break}return x},up:function(y){y=y||e.event;a.isCommand(n,y,function(){j.cmd=false},function(){j.cmd=true});w.clean();w.placeholders();var x;if(n.keyContext!==null&&(x=n.keyContext[y.keyCode])){var i=v.parent();if(i){x.call(w,y,i)}}o.preserveElementFocus()},command:{bold:function(i){a.preventDefaultEvent(i);(new d.Element(w,"bold")).setClean(false).invoke(n.beforeInvokeElement)},underline:function(i){a.preventDefaultEvent(i);(new d.Element(w,"underline")).setClean(false).invoke(n.beforeInvokeElement)},italicize:function(i){a.preventDefaultEvent(i);(new d.Element(w,"italic")).setClean(false).invoke(n.beforeInvokeElement)},quote:function(i){},paste:function(x){w.makeUndoable();if(n.pasteAsText){var i=t.saveSelection();a.pasteHook(function(y){t.restoreSelection(i);y=y.replace(/\n/g,"<br>");(new d.Html(w,y)).setClean(false).insert(n.beforeInsertHtml,true);w.clean();w.placeholders()})}else{w.clean();w.placeholders()}}},enterKey:function(z){if(n.mode===d.inlineMode||n.mode===d.inlineRichMode){return a.preventDefaultEvent(z)}if(j.shift){if(n.tags["break"]){a.preventDefaultEvent(z);w.addTag(n.tags["break"],true);return false}}else{var C=a.atCaret(w)||{},x=l.children,y=C===l.lastChild?l.lastChild:null,A,i,B;if(y&&y!==l.firstChild&&n.autoHR&&n.mode!=="partial"&&n.tags.horizontalRule){a.preventDefaultEvent(z);A=a.text(y)===""&&y.nodeName.toLowerCase()===n.tags.paragraph;if(A&&x.length>=2){i=x[x.length-2];if(i.nodeName.toLowerCase()===n.tags.horizontalRule){A=false}}if(A){w.addTag(n.tags.horizontalRule,false,true,C);C=C.nextSibling}if((B=w.addTag(n.tags.paragraph,true,null,C))!==null){B.innerHTML="";v.set(w,0,B)}}}return true},backspaceOrDeleteKey:function(z){if(n.onBackspaceOrDelete!==undefined){var i=n.onBackspaceOrDelete.call(w,z,l);if(i){return}}if(l.lastChild===null){return}var y=l.lastChild,x=y.previousSibling;if(y&&n.tags.horizontalRule&&y.nodeName.toLocaleLowerCase()===n.tags.horizontalRule){l.removeChild(y)}else{if(y&&x&&a.text(y).length<1&&x.nodeName.toLowerCase()===n.tags.horizontalRule&&y.nodeName.toLowerCase()===n.tags.paragraph){l.removeChild(y);l.removeChild(x)}}}},s={element:null,modifier:"auto",placeholder:"",autofocus:false,autoHR:true,mode:d.richMode,maxLength:-1,modifiers:{b:"bold",i:"italicize",u:"underline",v:"paste"},tags:{"break":"br",horizontalRule:"hr",paragraph:"p",outerLevel:["pre","blockquote","figure"],innerLevel:["a","b","u","i","img","strong"]},cssClasses:{editor:"Medium",pasteHook:"Medium-paste-hook",placeholder:"Medium-placeholder",clear:"Medium-clear"},attributes:{remove:["style","class"]},pasteAsText:true,beforeInvokeElement:function(){},beforeInsertHtml:function(){},maxLengthReached:function(i){},beforeAddTag:function(x,i,y,z){},keyContext:null,pasteEventHandler:function(y){y=y||e.event;w.makeUndoable();var i=w.value().length,z;if(n.pasteAsText){a.preventDefaultEvent(y);var x=t.saveSelection();w.prompt(function(A){A=A||"";if(A.length>0){l.focus();d.activeElement=l;t.restoreSelection(x);A=a.encodeHtml(A);z=A.length+i;if(n.maxLength>0&&z>n.maxLength){A=A.substring(0,n.maxLength-i)}if(n.mode!==d.inlineMode){A=A.replace(/\n/g,"<br>")}(new d.Html(w,A)).setClean(false).insert(n.beforeInsertHtml,true);w.clean();w.placeholders()}});return false}else{setTimeout(function(){w.clean();w.placeholders()},20)}},drag:false},n=a.deepExtend(s,q),l,k,p,m={},r;for(p in s){if(s.hasOwnProperty(p)){if(typeof s[p]!=="object"&&s.hasOwnProperty(p)&&n.element.getAttribute("data-medium-"+f)){k=n.element.getAttribute("data-medium-"+f);if(k.toLowerCase()==="false"||k.toLowerCase()==="true"){k=k.toLowerCase()==="true"}n[p]=k}}}if(n.modifiers){for(p in n.modifiers){if(typeof(f[p])!=="undefined"){n.modifiers[f[p]]=n.modifiers[p]}}}if(n.keyContext){for(p in n.keyContext){if(typeof(f[p])!=="undefined"){n.keyContext[f[p]]=n.keyContext[p]}}}l=n.element;l.contentEditable=true;l.className+=(" "+n.cssClasses.editor)+(" "+n.cssClasses.editor+"-"+n.mode);n.tags=(n.tags||{});if(n.tags.outerLevel){n.tags.outerLevel=n.tags.outerLevel.concat([n.tags.paragraph,n.tags.horizontalRule])}this.settings=n;this.element=l;this.intercept=u;this.action=o;this.cache=j;this.cursor=v;this.utils=a;this.selection=t;m.element=l;m.medium=this;m.settings=n;m.action=o;m.cache=j;m.cursor=v;m.intercept=u;m.utils=a;m.selection=t;o.setBridge(m);j.setBridge(m);t.setBridge(m);w.clean();w.placeholders();o.preserveElementFocus();o.listen();this.dirty=false;this.undoable=new d.Undoable(this);this.undo=this.undoable.undo;this.redo=this.undoable.redo;this.makeUndoable=this.undoable.makeUndoable;if(n.drag){r=w.drag=new d.Drag(w);a.addEvent(l,"mousemove",function(x){x=x||e.event;var i=x.target||{};if(i.getAttribute("contenteditable")==="false"){r.show(i)}})}l.medium=this;j.initialized=true};d.prototype={prompt:function(j){var i=window.prompt(d.Messages.pastHere);j(i);return this},placeholders:function(){if(!e.getComputedStyle){return}var n=this,t=this.settings,o=this.placeholder||(this.placeholder=h.createElement("div")),k=this.element,i=o.style,p=e.getComputedStyle(k,null),m=function(s){return p.getPropertyValue(s)},r=a.text(k),q=this.cursor,l=k.children.length,j=d.activeElement===k;k.placeholder=o;if(!j&&r.length<1&&l<2){if(k.placeHolderActive){return}if(!k.innerHTML.match("<"+t.tags.paragraph)){k.innerHTML=""}if(t.placeholder.length>0){if(!o.setup){o.setup=true;i.background=m("background");i.backgroundColor=m("background-color");i.fontSize=m("font-size");i.color=p.color;i.marginTop=m("margin-top");i.marginBottom=m("margin-bottom");i.marginLeft=m("margin-left");i.marginRight=m("margin-right");i.paddingTop=m("padding-top");i.paddingBottom=m("padding-bottom");i.paddingLeft=m("padding-left");i.paddingRight=m("padding-right");i.borderTopWidth=m("border-top-width");i.borderTopColor=m("border-top-color");i.borderTopStyle=m("border-top-style");i.borderBottomWidth=m("border-bottom-width");i.borderBottomColor=m("border-bottom-color");i.borderBottomStyle=m("border-bottom-style");i.borderLeftWidth=m("border-left-width");i.borderLeftColor=m("border-left-color");i.borderLeftStyle=m("border-left-style");i.borderRightWidth=m("border-right-width");i.borderRightColor=m("border-right-color");i.borderRightStyle=m("border-right-style");o.className=t.cssClasses.placeholder+" "+t.cssClasses.placeholder+"-"+t.mode;o.innerHTML="<div>"+t.placeholder+"</div>";k.parentNode.insertBefore(o,k)}k.className+=" "+t.cssClasses.clear;i.display="";i.minHeight=k.clientHeight+"px";i.minWidth=k.clientWidth+"px";if(t.mode!==d.inlineMode&&t.mode!==d.inlineRichMode){this.setupContents();if(l===0&&k.firstChild){q.set(this,0,k.firstChild)}}}k.placeHolderActive=true}else{if(k.placeHolderActive){k.placeHolderActive=false;i.display="none";k.className=a.trim(k.className.replace(t.cssClasses.clear,""));this.setupContents()}}},clean:function(i){var v=this.settings,m=v.cssClasses.placeholder,n=(v.attributes||{}).remove||[],w=v.tags||{},q=w.outerLevel||null,r=w.innerLevel||null,x={},u={},p=(w.paragraph||"").toUpperCase(),l=this.html,o,t,k;i=i||v.element;if(v.mode===d.inlineRichMode){q=v.tags.innerLevel}if(q!==null){for(k=0;k<q.length;k++){x[q[k].toUpperCase()]=true}}if(r!==null){for(k=0;k<r.length;k++){u[r[k].toUpperCase()]=true}}a.traverseAll(i,{element:function(C,s,A,y){var B=C.nodeName,j=true,z;for(k=0;k<n.length;k++){o=n[k];if(C.hasAttribute(o)){z=C.getAttribute(o);if(z!==m&&(!z.match("medium-")&&o==="class")){C.removeAttribute(o)}}}if(q===null&&r===null){return}if(A===1&&x[B]!==undefined){j=false}else{if(A>1&&u[B]!==undefined){j=false}}if(j){if(e.getComputedStyle(C,null).getPropertyValue("display")==="block"){if(p.length>0&&p!==B){a.changeTag(C,p)}if(A>1){while(y.childNodes.length>s){y.parentNode.insertBefore(y.lastChild,y.nextSibling)}}}else{switch(B){case"BR":if(C===C.parentNode.lastChild){if(C===C.parentNode.firstChild){break}t=document.createTextNode("");t.innerHTML="&nbsp";C.parentNode.insertBefore(t,C);break}default:while(C.firstChild!==null){C.parentNode.insertBefore(C.firstChild,C)}a.detachNode(C);break}}}}})},insertHtml:function(j,l,k){var i=(new d.Html(this,j)).insert(this.settings.beforeInsertHtml);if(k===true){a.triggerEvent(this.element,"change")}if(l){l.apply(i)}return this},addTag:function(j,i,k,m){if(!this.settings.beforeAddTag(j,i,k,m)){var n=h.createElement(j),l;if(typeof k!=="undefined"&&k===false){n.contentEditable=false}if(n.innerHTML.length==0){n.innerHTML=" "}if(m&&m.nextSibling){m.parentNode.insertBefore(n,m.nextSibling);l=m.nextSibling}else{this.element.appendChild(n);l=this.lastChild()}if(i){this.cache.focusedElement=l;this.cursor.set(this,0,l)}return n}return null},invokeElement:function(k,j,m){var l=this.settings,j=j||{},i=j.remove||[];switch(l.mode){case d.inlineMode:case d.partialMode:return this;default:}if(i.length>0){if(!a.arrayContains(l,"class")){i.push("class")}}(new d.Element(this,k,j)).invoke(this.settings.beforeInvokeElement);if(m===true){a.triggerEvent(this.element,"change")}return this},value:function(i){if(typeof i!=="undefined"){this.element.innerHTML=i;this.clean();this.placeholders()}else{return this.element.innerHTML}return this},focus:function(){var i=this.element;i.focus();return this},select:function(){var k=this.element,i,j;k.focus();if(h.body.createTextRange){i=h.body.createTextRange();i.moveToElementText(k);i.select()}else{if(e.getSelection){j=e.getSelection();i=h.createRange();i.selectNodeContents(k);j.removeAllRanges();j.addRange(i)}}d.activeElement=k;return this},isActive:function(){return(d.activeElement===this.element)},setupContents:function(){var l=this.element,j=l.children,m=l.childNodes,i,k=this.settings;if(!k.tags.paragraph||j.length>0||k.mode===d.inlineMode||k.mode===d.inlineRichMode){return d.Utilities}if(m.length>0){i=h.createElement(k.tags.paragraph);if(l.innerHTML.match("^[&]nbsp[;]")){l.innerHTML=l.innerHTML.substring(6,l.innerHTML.length-1)}i.innerHTML=l.innerHTML;l.innerHTML="";l.appendChild(i)}else{i=h.createElement(k.tags.paragraph);i.innerHTML="&nbsp;";l.appendChild(i)}return this},destroy:function(){var j=this.element,k=this.intercept,i=this.settings,l=this.placeholder||null;if(l!==null&&l.setup){l.parentNode.removeChild(l);delete j.placeHolderActive}j.removeAttribute("contenteditable");j.className=a.trim(j.className.replace(i.cssClasses.editor,"").replace(i.cssClasses.clear,"").replace(i.cssClasses.editor+"-"+i.mode,""));a.removeEvent(j,"keyup",k.up).removeEvent(j,"keydown",k.down).removeEvent(j,"focus",k.focus).removeEvent(j,"blur",k.focus).removeEvent(j,"paste",i.pasteEventHandler)},clear:function(){this.element.innerHTML="";this.placeholders()},splitAtCaret:function(){if(!this.isActive()){return null}var i=(e.getSelection||h.selection),o=i(),p=o.focusOffset,n=o.focusNode,k=this.element,j=h.createRange(),m=h.createRange(),l;j.setStart(n,p);m.selectNodeContents(k);j.setEnd(m.endContainer,m.endOffset);l=j.extractContents();return l},deleteSelection:function(){if(!this.isActive()){return}var j=g.getSelection(),i;if(j.rangeCount>0){i=j.getRangeAt(0);i.deleteContents()}},lastChild:function(){return this.element.lastChild}};d.inlineMode="inline";d.partialMode="partial";d.richMode="rich";d.inlineRichMode="inlineRich";d.Messages={pastHere:"Paste Here"};(function(j,i,k){j.Action=function(){};j.Action.prototype={setBridge:function(m){for(var l in m){if(m.hasOwnProperty(l)){this[l]=m[l]}}},listen:function(){var l=this.element,m=this.intercept;a.addEvent(l,"keyup",m.up).addEvent(l,"keydown",m.down).addEvent(l,"focus",m.focus).addEvent(l,"blur",m.blur).addEvent(l,"paste",this.settings.pasteEventHandler)},preserveElementFocus:function(){var m=i.getSelection?i.getSelection().anchorNode:k.activeElement;if(m){var l=this.medium.cache,q=this.settings,t=m.parentNode,o=q.element.children,r=t!==l.focusedElement,p=0,n;if(t===q.element){t=m}for(n=0;n<o.length;n++){if(t===o[n]){p=n;break}}if(r){l.focusedElement=t;l.focusedElementIndex=p}}}}})(d,e,h);(function(i){i.Cache=function(){this.initialized=false;this.cmd=false;this.focusedElement=null};i.Cache.prototype={setBridge:function(k){for(var j in k){if(k.hasOwnProperty(j)){this[j]=k[j]}}}}})(d);(function(i){i.Cursor=function(j){this.medium=j};i.Cursor.prototype={set:function(q,m){var j;if(h.createRange){var l=e.getSelection(),p=this.medium.lastChild(),o=a.text(p).length-1,k=m?m:p,n=((typeof q!=="undefined")&&(q!==null)?q:o);j=h.createRange();j.setStart(k,n);j.collapse(true);l.removeAllRanges();l.addRange(j)}else{j=h.body.createTextRange();j.moveToElementText(m);j.collapse(false);j.select()}},moveCursorToEnd:function(k){if(typeof k.selectionStart=="number"){k.selectionStart=k.selectionEnd=k.value.length}else{if(typeof k.createTextRange!="undefined"){k.focus();var j=k.createTextRange();j.collapse(false);j.select()}}},parent:function(){var k=null,j;if(e.getSelection){j=e.getSelection().getRangeAt(0);k=j.commonAncestorContainer;k=(k.nodeType===1?k:k.parentNode)}else{if(h.selection){k=h.selection.createRange().parentElement()}}if(k.tagName=="SPAN"){k=k.parentNode}return k},caretToBeginning:function(j){this.set(0,j)},caretToEnd:function(j){this.moveCursorToEnd(j)}}})(d);(function(i){i.Drag=function(k){this.medium=k;var m=this,j=this.iconSrc.replace(/[{][{]([a-zA-Z]+)[}][}]/g,function(o,n){if(m.hasOwnProperty(n)){return m[n]}return o}),l=this.icon=h.createElement("img");l.className=this.buttonClass;l.setAttribute("contenteditable","false");l.setAttribute("src",j);this.hide();this.element=null;this.protectedElement=null;a.addEvent(l,"dragstart",function(n){if(m.protectedElement!==null){return}n=n||e.event;m.protectedElement=a.detachNode(m.element);m.icon.style.opacity=0}).addEvent(l,"mouseover",function(n){if(m.protectedElement!==null){return}a.stopPropagation(n).addClass(m.element,m.elementClass)}).addEvent(l,"mouseout",function(n){if(m.protectedElement!==null){return}a.stopPropagation(n).removeClass(m.element,m.elementClass)}).addEvent(l,"dragend",h.body.ondragend=function(n){if(m.protectedElement===null){return}setTimeout(function(){m.cleanCanvas();m.protectedElement=null},1)})};i.Drag.prototype={elementClass:"Medium-focused",buttonClass:"Medium-drag",iconSrc:'data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="21.424px" height="21.424px" viewBox="0 0 21.424 21.424" style="enable-background:new 0 0 21.424 21.424;" xml:space="preserve">	<g>		<g>			<path style="fill:{{iconColor}};" d="M13.616,17.709L13.616,17.709h0.781l-3.686,3.715l-3.685-3.715h0.781l0,0H13.616z M13.616,17.709 M14.007,17.709 M12.555,19.566 M8.87,19.566 M7.418,17.709 M7.809,17.709 M10.712,17.709"/>			<path style="fill:{{iconColor}};" d="M13.616,3.715L13.616,3.715h0.781L10.712,0L7.027,3.715h0.781l0,0H13.616z M13.616,3.715 M14.007,3.715 M12.555,1.858 M8.87,1.858 M7.418,3.715 M7.809,3.715 M10.712,3.715"/>			<path style="fill:{{iconColor}};" d="M3.716,13.616L3.716,13.616v0.781L0,10.712l3.716-3.685v0.781l0,0V13.616z M3.716,13.616 M3.716,14.007 M1.858,12.555 M1.858,8.87 M3.716,7.417 M3.716,7.808 M3.716,10.712"/>			<path style="fill:{{iconColor}};" d="M17.709,13.616L17.709,13.616v0.781l3.715-3.685l-3.715-3.685v0.781l0,0V13.616z M17.709,13.616 M17.709,14.007 M19.566,12.555 M19.566,8.87 M17.709,7.417 M17.709,7.808 M17.709,10.712"/>		</g>		<path style="fill-rule:evenodd;clip-rule:evenodd;fill:{{iconColor}};" d="M10.712,6.608c2.267,0,4.104,1.838,4.104,4.104 c0,2.266-1.837,4.104-4.104,4.104c-2.266,0-4.104-1.837-4.104-4.104C6.608,8.446,8.446,6.608,10.712,6.608L10.712,6.608z M10.712,7.515c-1.765,0-3.196,1.432-3.196,3.197s1.432,3.197,3.196,3.197c1.766,0,3.197-1.432,3.197-3.197 S12.478,7.515,10.712,7.515z"/>	</g></svg>',iconColor:"#231F20",hide:function(){a.hide(this.icon)},show:function(k){if(k===this.icon&&this.protectedElement===null){return}this.element=k;var j=this.icon.style,m=k.offsetLeft,l=k.offsetTop;k.dragIcon=this.icon;k.parentNode.appendChild(this.icon);j.opacity=1;j.left=m+"px";j.top=l+"px";a.show(this.icon)},cleanCanvas:function(){var l,j=false,k=h.getElementsByClassName(this.buttonClass);this.icon.style.opacity=1;while(k.length>0){if(a.isVisible(l=k[0])){if(!j){l.parentNode.insertBefore(this.element,l);j=true}a.detachNode(l)}}a.detachNode(this.icon)}}})(d);(function(i){i.Element=function(k,l,j){this.medium=k;this.element=k.settings.element;switch(l.toLowerCase()){case"bold":this.tagName="b";break;case"italic":this.tagName="i";break;case"underline":this.tagName="u";break;default:this.tagName=l}this.attributes=j||{};this.clean=true};i.Element.prototype={invoke:function(n){if(i.activeElement===this.element){if(n){n.apply(this)}var j=this.attributes,m=this.tagName.toLowerCase(),l,k;if(j.className!==undefined){k=(j.className.split[" "]||[j.className]).shift();delete j.className}else{k="medium-"+m}l=g.createClassApplier(k,{elementTagName:m,elementAttributes:this.attributes});this.medium.makeUndoable();l.toggleSelection(e);if(this.clean){this.medium.clean();this.medium.placeholders()}}},setClean:function(j){this.clean=j;return this}}})(d);(function(i){i.Html=function(j,k){this.html=k;this.medium=j;this.element=j.settings.element;this.clean=true;this.injector=new i.Injector()};i.Html.prototype={insert:function(l,k){if(i.activeElement===this.element){if(l){l.apply(this)}var j=this.injector.inject(this.html,k);if(this.clean){this.medium.clean();this.medium.placeholders()}this.medium.makeUndoable();return j}else{return null}},setClean:function(j){this.clean=j;return this}}})(d);(function(i){i.Injector=function(){};i.Injector.prototype={inject:function(k){var m,j=false;if(typeof k==="string"){var p=h.createElement("div");p.innerHTML=k;m=p.childNodes;j=true}else{m=k}this.insertHTML('<span id="wedge"></span>');var o=h.getElementById("wedge"),n=o.parentNode,l=0;o.removeAttribute("id");if(j){while(l<m.length){n.insertBefore(m[l],o)}}else{n.insertBefore(m,o)}n.removeChild(o);o=null;return m},insertHTML:function(p,r){var l,q;if(e.getSelection){l=e.getSelection();if(l.getRangeAt&&l.rangeCount){q=l.getRangeAt(0);q.deleteContents();var m=h.createElement("div");m.innerHTML=p;var s=h.createDocumentFragment(),n,k;while((n=m.firstChild)){k=s.appendChild(n)}var j=s.firstChild;q.insertNode(s);if(k){q=q.cloneRange();q.setStartAfter(k);if(r){q.setStartBefore(j)}else{q.collapse(true)}l.removeAllRanges();l.addRange(q)}}}else{if((l=h.selection)&&l.type!="Control"){var o=l.createRange();o.collapse(true);l.createRange().pasteHTML(p);if(r){q=l.createRange();q.setEndPoint("StartToStart",o);q.select()}}}}}})(d);(function(i){i.Selection=function(){};i.Selection.prototype={setBridge:function(k){for(var j in k){if(k.hasOwnProperty(j)){this[j]=k[j]}}},saveSelection:function(){if(e.getSelection){var j=e.getSelection();if(j.rangeCount>0){return j.getRangeAt(0)}}else{if(h.selection&&h.selection.createRange){return h.selection.createRange()}}return null},restoreSelection:function(j){if(j){if(e.getSelection){var k=e.getSelection();k.removeAllRanges();k.addRange(j)}else{if(h.selection&&j.select){j.select()}}}}}})(d);(function(i){i.Toolbar=function(j,m){var k=h.createElement("div"),l=this;k.innerHTML=this.html;this.buttons=m;this.element=k.children[0];h.body.appendChild(this.element);this.active=false;this.busy=true;a.addEvents(document,"mouseup keyup",function(n){if(i.activeElement===j.element&&!l.busy){l.goToSelection()}}).addEvent(e,"scroll",function(){if(l.active){l.goToSelection()}})};i.Toolbar.prototype={fixedClass:"Medium-toolbar-fixed",showClass:"Medium-toolbar-show",hideClass:"Medium-toolbar-hide",html:'<div class="Medium-toolbar">				<div class="Medium-tail-outer">					<div class="Medium-tail-inner"></div>				</div>				<div id="Medium-buttons"></div>				<table id="Medium-options">					<tbody>						<tr>						</tr>					</tbody>				</table>			</div>',goToSelection:function(){var l=this.getHighlighted(),m=l.boundary.top-5,k=this.element,j=k.style;if(e.scrollTop>0){a.addClass(k,this.fixedClass)}else{a.removeClass(k,this.fixedClass)}if(l!==null){if(l.range.startOffset===l.range.endOffset&&!l.text){a.removeClass(k,this.showClass).addClass(k,this.hideClass);this.active=false}else{a.removeClass(k,this.hideClass).removeClass(k,this.showClass);j.opacity=0.01;a.addClass(k,this.showClass);j.opacity=1;j.top=(m-65)+"px";j.left=((l.boundary.left+(l.boundary.width/2))-(k.clientWidth/2))+"px";this.active=true}}},getHighlighted:function(){var k=e.getSelection(),j=(k.anchorNode?k.getRangeAt(0):false);if(!j){return null}return{selection:k,range:j,text:a.trim(j.toString()),boundary:j.getBoundingClientRect()}}}})(d);(function(i){i.Undoable=function(m){var p=this,n=m.settings.element,l=n.innerHTML,q,j=new Undo.Stack(),o=Undo.Command.extend({constructor:function(r,s){this.oldValue=r;this.newValue=s},execute:function(){},undo:function(){n.innerHTML=this.oldValue;m.canUndo=j.canUndo();m.canRedo=j.canRedo();m.dirty=j.dirty()},redo:function(){n.innerHTML=this.newValue;m.canUndo=j.canUndo();m.canRedo=j.canRedo();m.dirty=j.dirty()}}),k=function(){var r=n.innerHTML;if(r!=l){if(!p.movingThroughStack){j.execute(new o(l,r));l=r;m.dirty=j.dirty()}a.triggerEvent(m.settings.element,"change")}};this.medium=m;this.timer=q;this.stack=j;this.makeUndoable=k;this.EditCommand=o;this.movingThroughStack=false;a.addEvent(n,"keyup",function(r){if(r.ctrlKey||r.keyCode===f.z){a.preventDefaultEvent(r);return}clearTimeout(q);q=setTimeout(function(){k()},250)}).addEvent(n,"keydown",function(r){if(!r.ctrlKey||r.keyCode!==f.z){p.movingThroughStack=false;return}a.preventDefaultEvent(r);p.movingThroughStack=true;if(r.shiftKey){j.canRedo()&&j.redo()}else{j.canUndo()&&j.undo()}})}})(d);(function(i){i.Utilities={isCommand:function(m,o,n,l){if((m.modifier==="ctrl"&&o.ctrlKey)||(m.modifier==="cmd"&&o.metaKey)||(m.modifier==="auto"&&(o.ctrlKey||o.metaKey))){return n.call()}else{return l.call()}},isShift:function(n,m,l){if(n.shiftKey){return m.call()}else{return l.call()}},isModifier:function(m,o,l){var n=m.modifiers[o.keyCode];if(n){return l.call(null,n)}return false},special:(function(){var l={};l[f.backspace]=true;l[f.shift]=true;l[f.ctrl]=true;l[f.alt]=true;l[f["delete"]]=true;l[f.cmd]=true;return l})(),isSpecial:function(l,m){if(l){return true}return typeof i.Utilities.special[m.keyCode]!=="undefined"},navigational:(function(){var l={};l[f.upArrow]=true;l[f.downArrow]=true;l[f.leftArrow]=true;l[f.rightArrow]=true;return l})(),isNavigational:function(l){return typeof i.Utilities.navigational[l.keyCode]!=="undefined"},addEvents:function(p,q,r){var o=0,n,s=q.split(" "),l=s.length,m=i.Utilities;for(;o<l;o++){n=s[o];if(n.length>0){m.addEvent(p,n,r)}}return i.Utilities},addEvent:function j(m,l,n){if(m.addEventListener){m.addEventListener(l,n,false)}else{if(m.attachEvent){m.attachEvent("on"+l,n)}else{m["on"+l]=n}}return i.Utilities},removeEvent:function k(m,l,n){if(m.removeEventListener){m.removeEventListener(l,n,false)}else{if(m.detachEvent){m.detachEvent("on"+l,n)}else{m["on"+l]=null}}return i.Utilities},preventDefaultEvent:function(l){if(l.preventDefault){l.preventDefault()}else{l.returnValue=false}return i.Utilities},stopPropagation:function(l){l=l||window.event;l.cancelBubble=true;if(l.stopPropagation!==undefined){l.stopPropagation()}return i.Utilities},isEventSupported:function(n,l){l="on"+l;var o=h.createElement(n.tagName),m=(l in o);if(!m){o.setAttribute(l,"return;");m=typeof o[l]=="function"}o=null;return m},triggerEvent:function(m,l){var n;if(h.createEvent){n=h.createEvent("HTMLEvents");n.initEvent(l,true,true);n.eventName=l;m.dispatchEvent(n)}else{n=h.createEventObject();m.fireEvent("on"+l,n)}return i.Utilities},deepExtend:function(l,n){for(var m in n){if(n.hasOwnProperty(m)){if(n[m]&&n[m].constructor&&n[m].constructor===Object){l[m]=l[m]||{};i.Utilities.deepExtend(l[m],n[m])}else{l[m]=n[m]}}}return l},pasteHook:function(t,p){var q=h.createElement("textarea"),l=t.element,r,m,n,u=t.settings,o=t.html;q.className=u.cssClasses.pasteHook;l.parentNode.appendChild(q);q.focus();t.makeUndoable();setTimeout(function(){l.focus();if(u.maxLength>0){r=a.text(l);m=r.length;n=m+q.value.length;if(n>m){q.value=q.value.substring(0,u.maxLength-m)}}p(q.value);a.detachNode(q)},2);return i.Utilities},traverseAll:function(o,l,r){var n=o.childNodes,q=n.length,m=0,p,r=r||1;l=l||{};if(q>0){for(;m<q;m++){p=n[m];switch(p.nodeType){case 1:i.Utilities.traverseAll(p,l,r+1);if(l.element!==undefined){l.element(p,m,r,o)}break;case 3:if(l.fragment!==undefined){l.fragment(p,m,r,o)}}q=n.length;if(p===o.lastChild){m=q}}}return i.Utilities},trim:function(l){return l.replace(/^[\s]+|\s+$/g,"")},arrayContains:function(n,l){var m=n.length;while(m--){if(n[m]===l){return true}}return false},addClass:function(m,l){if(m.classList){m.classList.add(l)}else{m.className+=" "+l}return i.Utilities},removeClass:function(m,l){if(m.classList){m.classList.remove(l)}else{m.className=m.className.replace(new RegExp("(^|\\b)"+l.split(" ").join("|")+"(\\b|$)","gi")," ")}return i.Utilities},hasClass:function(m,l){if(m.classList){return m.classList.contains(l)}else{return new RegExp("(^| )"+l+"( |$)","gi").test(m.className)}},isHidden:function(l){return l.offsetWidth===0||l.offsetHeight===0},isVisible:function(l){return l.offsetWidth!==0||l.offsetHeight!==0},encodeHtml:function(l){return h.createElement("a").appendChild(h.createTextNode(l)).parentNode.innerHTML},text:function(l,m){if(m!==undefined){if(l.textContent!==undefined){l.textContent=m}else{l.innerText=m}return this}else{if(l.innerText!==undefined){return a.trim(l.innerText)}else{if(l.textContent!==undefined){return a.trim(l.textContent)}else{if(l.data!==undefined){return a.trim(l.data)}}}}return""},changeTag:function(p,n){var m=h.createElement(n),o,l;o=p.firstChild;while(o){l=o.nextSibling;m.appendChild(o);o=l}p.parentNode.insertBefore(m,p);p.parentNode.removeChild(p);return m},detachNode:function(l){if(l.parentNode!==null){l.parentNode.removeChild(l)}return l},baseAtCaret:function(n){if(!n.isActive()){return null}var o=e.getSelection?e.getSelection():document.selection;if(o.rangeCount){var m=o.getRangeAt(0),l=m.endContainer;switch(l.nodeType){case 3:if(l.data&&l.data.length!=m.endOffset){return false}break}return l}return null},atCaret:function(m){var l=this.baseAtCaret(m)||{},n=m.element;if(l===false){return null}while(l&&l.parentNode!==n){l=l.parentNode}if(l&&l.nodeType==1){return l}return null},hide:function(l){l.style.display="none"},show:function(l){l.style.display=""},hideAnim:function(l){l.style.opacity=1},showAnim:function(l){l.style.opacity=0.01;l.style.display=""}}})(d);g.rangePrototype.insertNodeAtEnd=function(j){var i=this.cloneRange();i.collapse(false);i.insertNode(j);i.detach();this.setEndAfter(j)};return d}()),a=b.Utilities;if(typeof define==="function"&&define.amd){define(function(){return b})}else{if(typeof module!=="undefined"&&module.exports){module.exports=b}else{if(typeof this!=="undefined"){this.Medium=b}}}}).call(this,window,document);